<!-- ===========================================================================
 * Test cLASS
 * @copyright Copyright 2016 Gerd Wagner, BTU (Germany) + ODU (VA, USA)
 * @author Gerd Wagner
 * @license The MIT License (MIT)
================================================================================ -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="utf-8">
  <title>cLASS-TestSuite01</title>
  <meta name="viewport" content="width=device-width, initial-scale = 1.0" />
  <link rel="stylesheet" href="../css/normalize.css" />
  <style>
    .failure {color: red;}
    .info {color: blue;}
    .okay {color: green;}
  </style>
  <!-- Basic libraries -->
  <script src="../lib/browserShims.js"></script>
  <script src="../lib/dom.js"></script>
  <script src="test.js"></script>
</head>
<body>
 <h1>bUSINESSoBJECT Test Suite 01: Basic Issues</h1>

 <script type="module">
 import bUSINESSoBJECT from "../src/bUSINESSoBJECT.mjs";

 /****************************************
 *** Test code **************************
 ****************************************/
 try {
   class Publisher extends bUSINESSoBJECT {
     constructor ({name, address}) {
       super( name);
       this.address = address;
     }
   }
   Publisher.properties = {
     "name": {range:"NonEmptyString", isIdAttribute: true, min: 2, max: 20},
     "address": {range:"NonEmptyString", min: 5, max: 50},
   }
   Publisher.setup();
   var p1 = new Publisher({name: "Springer", address:"Berlin, Germany"});

   class Book extends bUSINESSoBJECT {
     constructor ({isbn, title, year, publisher, edition}) {
       super( isbn);
       this.title = title;
       this.year = year;
       if (publisher) this.publisher = publisher;
       if (edition) this.edition = edition;
     }
   }
   Book.properties = {
     "isbn": {range:"NonEmptyString", isIdAttribute: true, label:"ISBN", pattern:/\b\d{9}(\d|X)\b/,
              patternMessage:"The ISBN must be a 10-digit string or a 9-digit string followed by 'X'!"},
     "title": {range:"NonEmptyString", min: 2, max: 50},
     "year": {range:"Integer", min: 1459, max: () => (new Date()).getFullYear() + 1},
     "publisher": {range:"Publisher", optional: true},
     "edition": {range:"PositiveInteger", optional: true}
   }
   Book.setup();
   var b1 = new Book({isbn: "123456789X", title:"Hello world", year: 2022});
   //*** Test Suite 1 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test Suite 1: Accessing properties"}));

   test( "b1 (should be) instanceof Book", b1 instanceof Book);
   test( "b1.year should be 2022", b1.year === 2022);
   b1.title = "New title";
   test("b1.title should be 'New title'", b1.title === "New title");
   if (test.okay) showSuccessMessage();
   else test.okay = true;  // reset test.okay

   //*** Test Suite 2 ***********************************************************
   document.body.appendChild(dom.createElement("h2", {content: "Test Suite 2: Constraint Validation"}));
   try {
     var b1 = new Book({isbn: "123456789", title:"Hello world", year: 2022});
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name +": "+ e.message}));
     test("Should be a PatternConstraintViolation", e.constructor.name === "PatternConstraintViolation");
     if (test.okay) showSuccessMessage();
     else test.okay = true;  // reset test.okay
   }



 } catch (e) {
   console.log( e.constructor.name +": "+ e.message);
}

  //*******************************************************************
  document.body.appendChild(dom.createElement("h2", {
    content:
        "Test Suite 3: Creating objects with slots for non-declared poperties and with instance-level method slots"
  }));
  /*
   var sD2 = new ServiceDesk({id: 12, testProp:"testPropValue",
       testMethod: function () {return true;}});
   showInfo("sD2.toString() = "+ sD2.toString());
   test( "The object sD2 should have the property 'testProp'", sD2.testProp);
   test( "The object sD2 should have the method 'testMethod'", sD2['testMethod']);
   test( "The invocation sD2.testMethod() should return true",  sD2.testMethod());
   if (test.okay) showSuccessMessage();
   else test.okay = true;  // reset test.okay
*/
 </script>
</body>
</html>

