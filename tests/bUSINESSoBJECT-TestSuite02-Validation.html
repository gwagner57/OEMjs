<!-- ===========================================================================
 * Test cLASS
 * @copyright Copyright 2016 Gerd Wagner, BTU (Germany) + ODU (VA, USA)
 * @author Gerd Wagner
 * @license The MIT License (MIT)
================================================================================ -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="utf-8">
  <title>cLASS-TestSuite01</title>
  <meta name="viewport" content="width=device-width, initial-scale = 1.0" />
  <link rel="stylesheet" href="../css/normalize.css" />
  <style>
    body { padding: 8px;}
    .failure {color: red;}
    .info {color: blue;}
    .okay {color: green;}
  </style>
  <!-- Basic libraries -->
  <script src="../lib/browserShims.js"></script>
  <script src="../lib/dom.js"></script>
  <script src="test.js"></script>
</head>
<body>
 <h1>bUSINESSoBJECT Test Suite 02: Constraint Validation</h1>

 <script type="module">
 import bUSINESSoBJECT from "../src/bUSINESSoBJECT.mjs";

 var failure=false;
 /****************************************
 *** Test code **************************
 ****************************************/
 try {
   class Publisher extends bUSINESSoBJECT {
     constructor({name, address}) {
       super(name);
       this.address = address;
     }
   }

   Publisher.properties = {
     "name": {range: "NonEmptyString", isIdAttribute: true, min: 2, max: 20},
     "address": {range: "NonEmptyString", min: 5, max: 50},
   }
   Publisher.setup();

   class Book extends bUSINESSoBJECT {
     constructor({isbn, title, year, publisher, edition}) {
       super(isbn);
       this.title = title;
       this.year = year;
       if (publisher) this.publisher = publisher;
       if (edition) this.edition = edition;
     }
   }

   Book.properties = {
     "isbn": {
       range: "NonEmptyString", isIdAttribute: true, label: "ISBN", pattern: /\b\d{9}(\d|X)\b/,
       patternMessage: "The ISBN must be a 10-digit string or a 9-digit string followed by 'X'!"
     },
     "title": {range: "NonEmptyString", min: 2, max: 50},
     "year": {range: "Integer", min: 1459, max: () => (new Date()).getFullYear() + 1},
     "publisher": {range: "Publisher", optional: true},
     "edition": {range: "PositiveInteger", optional: true}
   }
   Book.setup();
   //*** Test 1 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test 1: Valid data"}));
   try {
     var b1 = new Book({isbn: "123456789X", title: "Hello world", year: 2022});
     document.body.appendChild(dom.createElement("p", {content: "OKAY."}));
     failure = true;
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: "FAILED!"}));
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name + ": " + e.message}));
   }
   //*** Test 2 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test 2: Flawed ISBN"}));
   try {
     var b1 = new Book({
       isbn: "123456789",  // instead of "123456789X"
       title: "Hello world", year: 2022
     });
     document.body.appendChild(dom.createElement("p", {content: "FAILED!"}));
     failure = true;
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: "OKAY."}));
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name + ": " + e.message}));
   }
   //*** Test 3 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test 3: Missing value for ISBN"}));
   try {
     var b1 = new Book({title: "Hello world", year: 2022});
     document.body.appendChild(dom.createElement("p", {content: "FAILED!"}));
     failure = true;
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: "OKAY."}));
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name + ": " + e.message}));
   }
   //*** Test 4 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test 4: Wrong year"}));
   try {
     var b1 = new Book({isbn: "123456789X", title: "Hello world", year: 22});
     document.body.appendChild(dom.createElement("p", {content: "FAILED!"}));
     failure = true;
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: "OKAY."}));
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name + ": " + e.message}));
   }
   //*** Test 5 ***************************
   document.body.appendChild(dom.createElement("h2", {content: "Test 5: Deactivate Validation"}));
   try {
     bUSINESSoBJECT.areConstraintsToBeChecked = false;
     var b1 = new Book({isbn: "123456789X", title: "Hello world", year: 22});
     document.body.appendChild(dom.createElement("p", {content: "OKAY."}));
     failure = true;
   } catch (e) {
     document.body.appendChild(dom.createElement("p", {content: "FAILED!"}));
     document.body.appendChild(dom.createElement("p", {content: e.constructor.name + ": " + e.message}));
   }
 } catch (e) {
   console.log( e.constructor.name +": "+ e.message);
 }
 </script>
</body>
</html>

